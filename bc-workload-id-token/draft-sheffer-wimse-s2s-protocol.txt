



Workload Identity in Multi System Environments               B. Campbell
Internet-Draft                                             Ping Identity
Intended status: Standards Track                              D. Feldman
Expires: 8 December 2024                                                
                                                              J. Salowey
                                                                  Venafi
                                                      A. Schwenkschuster
                                                               Microsoft
                                                              Y. Sheffer
                                                                  Intuit
                                                             6 June 2024


                WIMSE Service to Service Authentication
                draft-sheffer-wimse-s2s-protocol-latest

Abstract

   TODO Abstract

About This Document

   This note is to be removed before publishing as an RFC.

   The latest revision of this draft can be found at
   https://yaronf.github.io/wimse-s2s/draft-sheffer-wimse-s2s-
   protocol.html.  Status information for this document may be found at
   https://datatracker.ietf.org/doc/draft-sheffer-wimse-s2s-protocol/.

   Discussion of this document takes place on the Workload Identity in
   Multi System Environments Working Group mailing list
   (mailto:wimse@ietf.org), which is archived at
   https://mailarchive.ietf.org/arch/browse/wimse/.  Subscribe at
   https://www.ietf.org/mailman/listinfo/wimse/.

   Source for this draft and an issue tracker can be found at
   https://github.com/yaronf/wimse-s2s.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 8 December 2024.

Copyright Notice

   Copyright (c) 2024 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
     1.1.  Deployment Architecture and Message Flow
   2.  Conventions and Definitions
   3.  Application Level Service To Service Authentication
     3.1.  The Workload Identity Token
     3.2.  Option 1: DPoP-Inspired Authentication
     3.3.  Option 2: Authentication Based on HTTP Message Signatures
   4.  Using Mutual TLS for Service To Service Authentication
   5.  Security Considerations
   6.  IANA Considerations
     6.1.  Media Type Registration
   7.  References
     7.1.  Normative References
     7.2.  Informative References
   Acknowledgments
   Authors' Addresses

1.  Introduction

   This document defines authentication and authorization in the context
   of interaction between two workloads.  This is the core component of
   the WIMSE architecture [I-D.ietf-wimse-arch].  Assume that Service A
   needs to call Service B.  For simplicity, this document focuses on
   HTTP-based services, and the service-to-service call consists of a
   single HTTP request and its response.  We define the credentials that
   both services should possess and how they are used to protect the
   HTTP exchange.

   There are multiple deployment styles in use today, and they result in
   different security properties.  We propose to address them
   differently.

   *  Many use cases have various middleboxes inserted between pairs of
      services, resulting in a transport layer that is not end-to-end
      encrypted.  We propose to address these use cases by protecting
      the HTTP messages at the application level (Section 3).

   *  The other commonly deployed architecture has a mutual-TLS
      connection between each pair of services.  This setup can be
      addressed by a simpler solution (Section 4).

   It is an explicit goal of this protocol that a service deployment can
   include both architectures across a multi-chain call.  In other
   words, Service A can call Service B with mutual TLS protection, while
   the next call to Service C is protected at the application level.

   For application-level protection we currently propose two alternative
   solutions, one inspired by DPoP [RFC9449] and one which is a profile
   of HTTP Message Signatures [RFC9421].  The design team believes that
   we need to pick one of these two alternatives for standardization,
   once we have understood their pros and cons.

1.1.  Deployment Architecture and Message Flow

   Regardless of the transport between the workloads, we assume the
   following logical architecture:

   +------------+               +------------+
   |            |               |            |
   |            |               | Workload B |
   | Workload A |==============>|            |
   |            |               |   +--------+
   |            |               |   |  PEP   |
   +------------+               +---+--------+
         ^                        ^     ^
         |                        |     |
         | +----------------------+     |
         | |                            |
         v v                            v
   +------------+               +------------+
   |            |               |            |
   |  Identity  |               |    PDP     |
   |   Server   |               | (optional) |
   |            |               |            |
   +------------+               +------------+

   The Identity Server provisions credentials to each of the workloads.
   At least Workload A (and possibly both) must be provisioned with a
   credential before the call can proceed.  Details of communication
   with the Identity Server are out of scope of this document, however
   we do describe the credential received by the workload.

   PEP is a Policy Enforcement Point, the component that allows the call
   to go through or blocks it.  PDP is an optional Policy Decision
   Point, which may be deployed in architectures where policy management
   is centralized.  All details of policy management and message
   authorization are out of scope of this document.

   The high-level message flow is as follows:

   *  Workload A obtains a credential from the Identity Server.  This
      happens periodically, e.g. once every 24 hours.

   *  Workload A makes an HTTP call into Workload B.  This is a regular
      HTTP request, with the additional protection mechanisms defined
      below.

   *  Workload B now authenticates Workload A and decides whether to
      authorize the call.  In certain architectures, Workload B may need
      to consult with an external server to decide whether to accept the
      call.

   *  Workload B returns a response to Workload A, which may be an error
      response or a regular one.

2.  Conventions and Definitions

   This document uses "service" and "workload" interchangeably.
   Otherwise, all terms are as defined by [I-D.ietf-wimse-arch].

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Application Level Service To Service Authentication

3.1.  The Workload Identity Token

   The Workload Identity Token (WIT) is a JWS [RFC7515] signed JWT
   [RFC7519] that represents the identity of a workload.  It is issued
   by the Identity Server and binds a public key to the workload
   identity.  A WIT MUST contain the following:

   *  in the JOSE header:

      -  alg: An identifier for a JWS asymmetric digital signature
         algorithm (registered algorithm identifiers are listed in the
         IANA JOSE Algorithms registry [IANA.JOSE.ALGS]).  The value
         none MUST NOT be used.

      -  typ: the WIT is explicitly typed, as recommended in
         Section 3.11 of [RFC8725], using the wimse-id+jwt media type.

   *  in the JWT claims:

      -  iss: The issuer of the token, which is the Identity Server,
         represented by a URI.

      -  sub: The subject of the token, which is the identity of the
         workload, represented by a URI.

      -  exp: The expiration time of the token (as defined in
         Section 4.1.4 of [RFC7519]).  WITs should be refreshed
         regularly, e.g. on the order of hours.

      -  jti: A unique identifier for the token.

      -  cnf: A confirmation claim containing the public key of the
         workload using the jwk member as defined in Section 3.2 of
         [RFC7800].  The workload MUST prove possession of the
         corresponding private key when presenting the WIT to another
         party.

   An example WIT might look like this (all examples, of course, are
   non-normative and with line breaks and extra space for readability):

   eyJ0eXAiOiJ3aW1zZS1pZCtqd3QiLCJhbGciOiJFUzI1NiIsImtpZCI6Ikp1bmUgNSJ9.
   eyJpc3MiOiJ3aW1zZTovL2V4YW1wbGUuY29tL3RydXN0ZWQtY2VudHJhbC1hdXRob3Jpd
   HkiLCJleHAiOjE3MTc2MTI0NzAsInN1YiI6IndpbXNlOi8vZXhhbXBsZS5jb20vc3BlY2
   lmaWMtd29ya2xvYWQiLCJqdGkiOiJ4LV8xQ1RMMmNjYTNDU0U0Y3diX18iLCJjbmYiOns
   iandrIjp7Imt0eSI6Ik9LUCIsImNydiI6IkVkMjU1MTkiLCJ4IjoiX2FtUkMzWXJZYkho
   SDFSdFlyTDhjU21URE1oWXRPVVRHNzhjR1RSNWV6ayJ9fX0.rOSUMR8I5WhM5C704l3iV
   dY0zFqxhugJ8Jo2xo39G7FqUTbwTzAGdpz2lHp6eL1M486XmRgl3uyjj6R_iuzNOA

   The decoded JOSE header of the WIT from the example above is shown
   here:

   {
    "typ": "wimse-id+jwt",
    "alg": "ES256",
    "kid": "June 5"
   }

   The decoded JWT claims of the WIT from the example above are shown
   here:

   {
    "iss": "wimse://example.com/trusted-central-authority",
    "exp": 1717612470,
    "sub": "wimse://example.com/specific-workload",
    "jti": "x-_1CTL2cca3CSE4cwb__",
    "cnf": {
     "jwk": {
      "kty": "OKP",
      "crv": "Ed25519",
      "x": "_amRC3YrYbHhH1RtYrL8cSmTDMhYtOUTG78cGTR5ezk"
     }
    }
   }

   The claims indicate that the example WIT:

   *  was issued by an Identity Server known as wimse://example.com/
      trusted-central-authority.

   *  is valid until May 15, 2024 3:28:45 PM GMT-06:00 (represented as
      NumericDate Section 2 of [RFC7519] value 1717612470).

   *  identifies the workload to which the token was issued as
      wimse://example.com/specific-workload.

   *  has a unique identifier of x-_1CTL2cca3CSE4cwb__.

   *  binds the public key represented by the jwk confirmation method to
      the workload wimse://example.com/specific-workload.

   The afore-exampled WIT is signed with the private key of the Identity
   Server.  The public key(s) of the Identity Server need to be known to
   all workloads in order to verify the signature of the WIT.  The
   Identity Server's public key from this example is shown below in JWK
   [RFC7517] format:

   {
    "kty":"EC",
    "kid":"June 5",
    "x":"kXqnA2Op7hgd4zRMbw0iFcc_hDxUxhojxOFVGjE2gks",
    "y":"n__VndPMR021-59UAs0b9qDTFT-EZtT6xSNs_xFskLo",
    "crv":"P-256"
   }

3.2.  Option 1: DPoP-Inspired Authentication

3.3.  Option 2: Authentication Based on HTTP Message Signatures

4.  Using Mutual TLS for Service To Service Authentication

5.  Security Considerations

   TODO Security and Privacy

   TLS trust assumptions, server vs mutual auth, middleboxes

6.  IANA Considerations

   TODO IANA

   TODO: maybe a URI Scheme registraion of wimse in URI schemes
   (https://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml) per
   [RFC7595] but it's only being used in an example right now and might
   not even be appropriate.  Or maybe use an ietf URI scheme a la URN
   Namespace for IETF Use (https://www.iana.org/assignments/params/
   params.xhtml) somehow.  Or maybe nothing.  Or maybe something else.

6.1.  Media Type Registration

   TODO: application/wimse-id+jwt or appropriately bikeshedded media
   type name (dispite my ongoing unease with using media types for
   typing JWTs) in Media Types (https://www.iana.org/assignments/media-
   types/media-types.xhtml).

7.  References

7.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/rfc/rfc2119>.

   [RFC7515]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web
              Signature (JWS)", RFC 7515, DOI 10.17487/RFC7515, May
              2015, <https://www.rfc-editor.org/rfc/rfc7515>.

   [RFC7517]  Jones, M., "JSON Web Key (JWK)", RFC 7517,
              DOI 10.17487/RFC7517, May 2015,
              <https://www.rfc-editor.org/rfc/rfc7517>.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, DOI 10.17487/RFC7519, May 2015,
              <https://www.rfc-editor.org/rfc/rfc7519>.

   [RFC7800]  Jones, M., Bradley, J., and H. Tschofenig, "Proof-of-
              Possession Key Semantics for JSON Web Tokens (JWTs)",
              RFC 7800, DOI 10.17487/RFC7800, April 2016,
              <https://www.rfc-editor.org/rfc/rfc7800>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

   [RFC8725]  Sheffer, Y., Hardt, D., and M. Jones, "JSON Web Token Best
              Current Practices", BCP 225, RFC 8725,
              DOI 10.17487/RFC8725, February 2020,
              <https://www.rfc-editor.org/rfc/rfc8725>.

   [RFC9421]  Backman, A., Ed., Richer, J., Ed., and M. Sporny, "HTTP
              Message Signatures", RFC 9421, DOI 10.17487/RFC9421,
              February 2024, <https://www.rfc-editor.org/rfc/rfc9421>.

7.2.  Informative References

   [I-D.ietf-wimse-arch]
              Salowey, J. A., Rosomakho, Y., and H. Tschofenig,
              "Workload Identity in a Multi System Environment (WIMSE)
              Architecture", Work in Progress, Internet-Draft, draft-
              ietf-wimse-arch-00, 18 April 2024,
              <https://datatracker.ietf.org/doc/html/draft-ietf-wimse-
              arch-00>.

   [IANA.JOSE.ALGS]
              "JSON Web Signature and Encryption Algorithms", n.d.,
              <https://www.iana.org/assignments/jose/jose.xhtml#web-
              signature-encryption-algorithms>.

   [RFC7595]  Thaler, D., Ed., Hansen, T., and T. Hardie, "Guidelines
              and Registration Procedures for URI Schemes", BCP 35,
              RFC 7595, DOI 10.17487/RFC7595, June 2015,
              <https://www.rfc-editor.org/rfc/rfc7595>.

   [RFC9449]  Fett, D., Campbell, B., Bradley, J., Lodderstedt, T.,
              Jones, M., and D. Waite, "OAuth 2.0 Demonstrating Proof of
              Possession (DPoP)", RFC 9449, DOI 10.17487/RFC9449,
              September 2023, <https://www.rfc-editor.org/rfc/rfc9449>.

Acknowledgments

   TODO acknowledge.

Authors' Addresses

   Brian Campbell
   Ping Identity
   Email: bcampbell@pingidentity.com


   Daniel Feldman


   Joe Salowey
   Venafi
   Email: joe.salowey@gmail.com


   Arndt Schwenkschuster
   Microsoft
   Email: arndts.ietf@gmail.com


   Yaron Sheffer
   Intuit
   Email: yaronf.ietf@gmail.com
